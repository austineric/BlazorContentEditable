@inject IJSRuntime JSRuntime

<textarea id="@DivID" @attributes="AttributesList" ></textarea>

@code {

    [Parameter]
    public string InitialText { get; set; }

    [Parameter]
    public string CSSClass { get; set; }

    [Parameter]
    public string CSSStyle { get; set; }

    [Parameter]
    public int Rows { get; set; }

    [Parameter]
    public int Columns { get; set; }

    [Parameter]
    public string Width { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public EventCallback<string> UpdatedText { get; set; }

    //component elements
    private string TextToDisplay { get; set; }
    private Random RandomNumberGenerator { get; set; } = new Random();
    private int DivID { get; set; }
    private Dictionary<string, object> AttributesList = new Dictionary<string, object>();

    protected override void OnInitialized()
    {
        DivID = RandomNumberGenerator.Next();
        TextToDisplay = string.IsNullOrWhiteSpace(InitialText) ? "" : InitialText;

        //add Rows if supplied, default to 1 if not supplied
        AttributesList.Add("rows", Rows == 0 ? 1 : Rows);

        //add overflow:hidden to prevent scrollbars from showing
        CSSStyle = CSSStyle + "overflow:hidden;";

        //set width
        if (!string.IsNullOrWhiteSpace(Width))  //if Width  was supplied add to CSSStyle
        {
            CSSStyle = CSSStyle + Width;
        }
        else if (Columns != 0)  //if Columns was supplied add to AttributesList
        {
            AttributesList.Add("columns", Columns);
        }
        else    //if neither Width nor Columns was supplied set width to 100%
        {
            CSSStyle = CSSStyle + "width:100%;";
        }

        //add disabled if supplied
        if (Disabled)
        {
            AttributesList.Add("disabled", "disabled");
        }

        //add CSSClass if supplied
        if (!string.IsNullOrWhiteSpace(CSSClass))
        {
            AttributesList.Add("class", CSSClass);
        }

        //add CSSStyle
        AttributesList.Add("style", CSSStyle);
    }

    //send initial text (if supplied) to javascript to place in the div
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeAsync<string>("BlazorContentEditable", DivID, DotNetObjectReference.Create(this), TextToDisplay);
        }
    }

    //receive input text from javascript and invoke callback to parent component
    [JSInvokable]
    public void GetUpdatedTextFromJavascript(string TextFromJavascript)
    {
        UpdatedText.InvokeAsync(TextFromJavascript);
    }

}
